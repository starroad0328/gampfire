# 개발일지 - 2025년 11월 29일

## 완료한 작업

### 팔로워/팔로잉 수 표시 기능
- 프로필 페이지에 팔로워와 팔로잉 수 표시 추가
- Follow 테이블 쿼리로 정확한 수 계산
- "팔로워 · 팔로잉" 형식으로 표시 (예: 5 · 12)
- Users 아이콘 추가 (lucide-react)
- 본인 프로필과 다른 사용자 프로필 모두 표시
- 통계 섹션 최상단에 배치

### Vercel 배포 완료
- TypeScript 컴파일 에러 전체 수정 (9개 파일)
  - community-backup, scripts 폴더 TypeScript 컴파일 제외
  - similarity 프로퍼티 누락 수정
  - igdbId null 체크 추가
  - implicit any 타입 명시
  - email 프로퍼티 non-null assertion 추가
  - 중복 igdbId 프로퍼티 제거
  - follows 프로퍼티 타입 assertion
  - credentials 파라미터 타입 annotation
- Vercel 프로덕션 배포 성공
- 빌드 통계: 51개 페이지, 42개 API 라우트
- 빌드 시간: 52초

### 배포 설정
- Vercel CLI 설치 및 로그인
- 프로젝트 연결 및 빌드 설정 자동 감지
- tsconfig.json 수정으로 빌드 에러 해결

## 기술 스택
- Vercel (배포)
- TypeScript (타입 안정성)
- Next.js 16.0.1
- PostgreSQL (Neon)
- Prisma ORM

## 배포 URL
- Production: https://gamerate2-luxlf6md1-starroad0328s-projects.vercel.app

---

## 오후 작업 - 환경 변수 설정 및 인기 게임 문제 해결

### Vercel 환경 변수 설정 (CLI)
**설정 완료:**
- DATABASE_URL (Neon PostgreSQL)
- NEXTAUTH_URL, NEXTAUTH_SECRET (새로 생성)
- IGDB_CLIENT_ID, IGDB_CLIENT_SECRET (새로 발급)
- RAWG_API_KEY
- STEAM_API_KEY (B45C63011B033E2671FC470F9C2D1C9D)
- EMAIL_HOST, EMAIL_PORT, EMAIL_USER, EMAIL_PASSWORD
- ADMIN_EMAIL

**방법:**
- Vercel CLI로 모든 환경(Production, Preview, Development)에 추가
- 로컬 .env 파일도 동기화

### IGDB API 키 문제 해결
**문제:**
- 기존 Client Secret 만료
- 빌드 시 403 에러: "invalid client secret"

**해결:**
- Twitch 개발자 콘솔에서 OAuth 리디렉션 URL 변경
- 새로운 Client Secret 발급: ogezg1ash74dzezashvuevcs2zi9px
- curl로 API 테스트 성공 (access_token 정상 발급)
- Vercel 환경 변수 업데이트

### 메인 페이지 인기 게임 표시 문제 해결
**문제:**
- 인기 게임 배경이 표시되지 않음
- Vercel 빌드 시 localhost API 호출 실패

**해결 과정:**
1차 시도: VERCEL_URL 환경 변수 사용 → 실패
2차 시도: fetch → 직접 IGDB API 호출로 변경 → 성공

**수정 파일:** `src/app/page.tsx`
```typescript
// Before
const response = await fetch(`${baseUrl}/api/games/list?type=popular&limit=60`)

// After
import { getPopularGames as getPopularGamesAPI } from '@/lib/igdb'
const games = await getPopularGamesAPI(60, 0)
```

**결과:**
- ✅ 빌드 로그: "✅ Loaded 60 popular games from IGDB"
- ✅ 인기 게임 배경 정상 표시

### Git 커밋
```
bb0d030 - Fix popular games loading by using direct IGDB API calls
```

### 최종 배포
- Production: https://gamerate2-pddo1a48e-starroad0328s-projects.vercel.app
- 빌드 상태: ✅ 성공
- 모든 환경 변수 적용 완료

## 🐛 알려진 문제
- **추천 게임 탭**: getRecommendedGames()도 fetch 사용 → 내일 수정 필요

## 참고사항
- 로컬과 Vercel이 같은 Neon DB 사용 (데이터 공유)
- Server Component에서 fetch 대신 직접 함수 호출 권장
- Vercel 빌드 환경에서는 localhost 사용 불가

---

## 2025년 11월 30일 - 도메인 연결 및 추천 게임 수정

### 도메인 연결 완료
- **새 도메인**: gampfire.com 구매 및 연결
- **URL**: https://www.gampfire.com
- 네임서버 설정 완료
- Vercel 환경 변수 업데이트: NEXTAUTH_URL → https://www.gampfire.com

### 추천 게임 탭 수정 완료
**문제:**
- 메인 페이지에서 추천 게임 fetch 사용 → Vercel 빌드 시 실패 가능

**해결 방법:**
1. 추천 게임 로직을 재사용 가능한 함수로 분리
   - 새 파일 생성: `src/lib/recommendations.ts`
   - `getRecommendedGamesForUser(userId, limit)` 함수 추출
   - 협업 필터링 + 콘텐츠 기반 추천 로직 포함

2. API route 단순화
   - `src/app/api/games/recommended/route.ts` 대폭 간소화
   - 새로 만든 `getRecommendedGamesForUser` 함수 호출

3. 메인 페이지 수정
   - `src/app/page.tsx`의 `getRecommendedGames` 함수 수정
   - fetch 제거 → 직접 `getRecommendedGamesForUser` 호출
   - Server Component에서 직접 함수 호출로 변경

**수정 파일:**
- `src/lib/recommendations.ts` (신규 생성)
- `src/app/api/games/recommended/route.ts`
- `src/app/page.tsx`

**결과:**
- ✅ 로컬 빌드 성공
- ✅ TypeScript 컴파일 에러 없음
- ✅ 51개 페이지, 42개 API 라우트 생성 확인

### 다음 작업
- [ ] Vercel 재배포 (추천 게임 수정 반영)
- [ ] 전체 기능 프로덕션 테스트 (gampfire.com)
