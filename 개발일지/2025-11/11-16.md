# 개발일지 - 2025년 11월 16일

## 완료한 작업

### 리뷰 시스템 개선 - 좋아요/싫어요 기능
- 리뷰 삭제 기능 추가
  - 리뷰 작성 폼의 취소 버튼 → 삭제 버튼으로 변경
  - 삭제 확인 다이얼로그 추가
  - `/api/reviews/delete` 엔드포인트 생성
- 전체 리뷰 페이지 구현
  - `/games/[id]/reviews` 페이지 생성
  - 무한 스크롤 구현 (20개씩 로딩)
  - IntersectionObserver로 자동 로딩
  - 게임 헤더 (커버 이미지, 제목, 평점)
  - `/api/games/[id]/reviews` API 엔드포인트 (페이지네이션)

#### Steam 스타일 리뷰 카드 디자인
- 프로필 사진 제거
- 추천/비추천 배지 표시 (별점 3.0 기준)
- 작성 날짜 표시
- 좋아요/싫어요 버튼 추가

#### 좋아요/싫어요 투표 시스템
- 상호 배타적 투표 (좋아요 OR 싫어요만 선택 가능)
- 같은 버튼 재클릭 시 투표 취소 (토글)
- 좋아요만 카운트 표시, 싫어요는 선택 상태만 표시
- 좋아요: 파란색 배경, 싫어요: 빨간색 배경
- ReviewLike 스키마에 type 필드 추가 ('like' | 'dislike')
- `/api/reviews/[id]/like` 엔드포인트 수정

#### 투표 상태 유지 기능
- API에서 사용자의 기존 투표 정보 반환 (userVote 필드)
- 페이지 로드 시 투표 상태 자동 초기화
- 새로고침 후에도 투표 상태 유지
- 게임 상세 페이지 및 전체 리뷰 페이지 모두 적용

### 온보딩 프로그램 수정
- 온보딩 페이지 개선 및 버그 수정 완료
- 게임 평가 저장 기능 구현
- 온보딩 완료 플로우 개선

### 관리자 페이지 및 역할 기반 배지 시스템
- 관리자 페이지 구현 (`/admin/users`)
  - 사용자 목록 조회 및 관리
  - 역할 변경 기능 (user, expert, influencer)
  - 검색 기능 (이메일, 이름, 사용자명)
  - 정렬 기능 (이름, 이메일, 리뷰 수, 가입일)
  - 통계 카드 (전체 사용자, 전문가, 인플루언서, 전체 리뷰)
  - Toast 알림 시스템
  - 한국어 UI
- 관리자 API 엔드포인트
  - `/api/admin/users` - 사용자 목록 조회 (관리자 전용)
  - `/api/admin/users/update-role` - 역할 변경 (관리자 전용)
  - 환경 변수 기반 관리자 인증 (ADMIN_EMAIL=starroad0328@naver.com)
- 역할 기반 인증 평가 시스템
  - 게임 상세 페이지의 "인증된 평가"를 expert + influencer 역할 기반으로 변경
  - isVerified 필드 대신 role 필드 사용
  - `/api/games/[id]` 수정하여 role 기반 통계 산출
- UI 컴포넌트 생성
  - Table 컴포넌트 (`/src/components/ui/table.tsx`)
  - Toast 컴포넌트 (`/src/components/ui/toast.tsx`)
  - use-toast 훅 (`/src/hooks/use-toast.ts`)
  - Toaster를 layout.tsx에 추가
- 프로필 페이지 개선
  - 관리자 전용 패널 추가 (관리자 페이지 링크)
  - 관리자 이메일 기반 조건부 렌더링
- UTF-8 인코딩 이슈 해결
  - 한국어 텍스트 파일 오류 발생 시 완전 재작성으로 해결

### 게임 상세 페이지 최종 레이아웃 및 UX 개선
- Race condition 에러 수정
  - 게임 ID 동시 조회 시 발생하는 unique constraint 에러 해결
  - P2002 에러 발생 시 자동으로 DB에서 재조회
- 스크롤 위치 저장 및 복원
  - 게임 목록 페이지에서 스크롤 위치 sessionStorage에 저장
  - 게임 상세 페이지 → 뒤로가기 시 이전 스크롤 위치 복원
  - 게임 상세 페이지 진입 시 스크롤 맨 위로 초기화
- 게임 상세 페이지 최종 레이아웃 확정
  - 3열 그리드: 포스터(320px) | 게임 정보(380px) | 트레일러(1fr)
  - 별점 크기 확대 (w-10 h-10, text-4xl)
  - 상세 정보(출시일, 개발사, 장르, 플랫폼) 하단 배치
  - 트레일러 전체 높이 및 최대 너비 활용
  - max-w-7xl 제거하여 헤더 경계까지 전체 공간 활용
- UI 디자인 가이드 문서 생성
  - 게임 상세 페이지 전용 레이아웃 가이드 작성
  - 파일 위치: `UI-디자인-가이드.md`
- 사용자 평가 모아보기 페이지
  - `/profile/reviews` 페이지 생성
  - 왼쪽: 사용자 프로필 카드 (프로필 사진, 통계)
  - 오른쪽: 모든 평가 리스트 (세부 평점 포함)
  - 프로필 페이지에서 평가 3개 초과 시 "모든 평가 보기" 링크 표시
  - 프로필 페이지 최근 평가 5개로 제한
- 리뷰 시스템 개선
  - 게임 상세 페이지에서 기존 별점 자동 동기화
  - API에서 현재 사용자의 리뷰 조회 후 폼에 자동 로드
  - "리뷰 작성" → "내 리뷰 수정" 제목 자동 변경

### 게임 목록 및 온보딩 개선
- Steam 가격 정보 표시 수정 (steamData.priceInfo 중첩 구조 적용)
- 리뷰 작성 폼 통합 및 토글 기능 추가
  - ReviewButton과 ReviewSection 컴포넌트 게임 상세 페이지에 통합
  - 리뷰 작성 버튼 재클릭 시 폼 닫힘 (toggleReviewForm 이벤트)
- 게임 목록 페이지 개선
  - 그리드 크기 변경: 5x4 → 6x5 (xl:grid-cols-6)
  - 무한 스크롤 구현 (30개씩 로딩)
  - IntersectionObserver를 이용한 자동 로딩
  - 중복 게임 방지 로직 추가
- 온보딩 페이지 개선
  - 로그인한 사용자가 이미 별점 남긴 게임 필터링
  - /api/games/popular 및 /api/games/recent에 세션 기반 필터링 적용
  - 2배 많이 가져온 후 필터링하여 충분한 게임 표시

## 기술 스택
- Prisma (ReviewLike type 필드)
- Next.js (무한 스크롤)
- IntersectionObserver API
- sessionStorage (스크롤 위치 저장)

## UX 개선
- Steam 스타일 리뷰 시스템
- 상호 배타적 투표로 명확한 의사 표시
- 투표 상태 유지로 일관된 경험
- 관리자 페이지로 효율적인 사용자 관리
- 스크롤 위치 복원으로 탐색 편의성 향상
