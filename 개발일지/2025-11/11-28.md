# 개발일지 - 2025년 11월 28일

## 완료한 작업

### 개발일지 시스템 구축
- 날짜별 개발일지 파일 생성 (11-14 ~ 11-27, 총 14개)
- 메모.txt 간소화 및 구조 개선
- 개발일지 README.md 작성
- 개발일지 폴더 구조 체계화

### 리뷰 시스템 통합
- 인증된 평가와 일반 평가 구분 제거
- 모든 리뷰를 하나의 통합 평점으로 표시
- 게임 상세 페이지 레이아웃 변경 (2:1:1 → 2:2)
- 모든 별점 주황색으로 통일 (파란색 제거)
- API에서 expertStats, userStats 분리 제거
- 통계 섹션: 인증된 평가/일반 평가 → 전체 평균으로 통합

### HOT 게임 탭 개선
- Steam 동시 접속자 수 기반으로 변경
- DB 스키마: currentPlayers, playersUpdatedAt 필드 추가
- HOT 게임 API: currentPlayers DESC로 정렬
- IGDB Steam ID 매칭 정확도 대폭 향상
  - URL 정확한 매칭 (730과 730820 구분)
  - 이름 매칭 엄격화 (완전 일치 우선, fuzzy 80%+)
- 배치 작업 개선
  - getSteamMostPlayed의 currentPlayers 직접 사용
  - getSteamKoreanName으로 게임 이름 자동 조회
- Vercel cron job 설정 (매일 00:00 UTC)
- DEPLOYMENT.md 배포 가이드 작성
- 검증 완료: Counter-Strike 2, Dota 2 등 실제 인기 게임 상위 표시

### 메인 페이지 개선
- Hero 섹션 "게임 둘러보기" 버튼 제거
- 추천 게임 섹션 개편
  - 로그인 시: 4개 게임 카드 표시
  - 비로그인 시: 로그인 안내 카드 표시
- "더 보기" 버튼 추가 (→ /games?tab=recommended)
- 추천 게임 4개로 제한 (slice(0, 4))

### 검색 기능 개선 (pg_trgm)
- PostgreSQL pg_trgm 확장 활성화
- GIN 인덱스 생성 (Game.title)
- DB 우선 검색 전략
  - similarity() 함수로 유사도 계산
  - ILIKE로 부분 검색
  - totalReviews로 2차 정렬
- IGDB 보충 검색 (DB 결과 < 10개)
- 복합 점수 시스템 (rating_count 50%, follows 30%, DB 리뷰 20%)
- setup-trgm.ts 스크립트 추가
- 검증: "battle" → Battlefield 6 정확히 검색

### 리뷰 표시 개선
- 코멘트 없는 리뷰도 게임 상세 페이지에 표시
- 별점만 남긴 평가 포함
- API 필터 제거 (create, race condition, update 3곳)

### 관리자 기능 강화
- 사용자 삭제 기능 추가
- 휴지통 아이콘 버튼
- 삭제 확인 다이얼로그
- 본인 계정 삭제 방지
- 삭제 시 게임 통계 자동 재계산

### UI/UX 개선
- 프로필 페이지 sticky 위치 조정 (top-4 → top-24)
- 전체 리뷰 페이지 sticky 위치 조정
- 헤더 메뉴: "리스트" → "취향 설정"
- 온보딩 페이지: "취향 평가" → "점화 세팅"

### 프로필 설정 확장
- DB 스키마: bio, preferredPlatform 필드 추가
- 설정 페이지에 입력 필드 추가
  - 한 줄 소개 (최대 100자)
  - 선호 플랫폼 선택 (PC/PlayStation/Nintendo/Xbox/모바일)
- 프로필 페이지에 bio와 플랫폼 표시
  - bio: 회색 박스에 중앙 정렬
  - 플랫폼: 게임패드 아이콘과 함께 표시

### 계정 관리
- 설정 페이지에 "계정 관리" 탭 추가 (3개 탭)
- 계정 탈퇴 기능 구현
  - 2단계 확인 (confirm + "삭제" 입력)
  - 삭제되는 데이터 안내 (리뷰, 좋아요, 프로필 등)
  - 빨간색 경고 UI
- 사용자 계정 삭제 API (/api/user/delete-account)
- 탈퇴 시 게임 통계 자동 재계산

### 팔로우 시스템
- Follow 모델 활용
- 팔로우/언팔로우 API (/api/user/follow)
- FollowButton 컴포넌트 생성
- 다른 사용자 프로필에 팔로우 버튼 표시
- 팔로우 상태 확인 및 토글
- 팔로우 시 상대방에게 알림 발송

### 알림 시스템
- Notification 모델 추가
  - type: FOLLOW, REVIEW 등
  - message, actorId, gameId, reviewId
  - isRead 플래그
- 알림 API (/api/notifications)
  - GET: 알림 목록 조회
  - POST: 읽음 처리
- 헤더에 알림 벨 아이콘 추가
  - 읽지 않은 알림 수 빨간 배지 표시
  - 드롭다운으로 최근 10개 알림 표시
  - 클릭 시 읽음 처리
- 리뷰 작성 시 팔로워에게 자동 알림 발송
- 새 리뷰만 알림 (수정은 알림 없음)

### 사용자 경험 개선
- 다른 사용자의 모든 평가 보기 기능
  - /profile/reviews?userId={userId}
  - "모든 평가 보기" 링크에 userId 파라미터 추가
  - 뒤로가기 버튼도 해당 사용자 프로필로 이동

### 데이터 정합성
- 게임 통계 재계산 스크립트 작성
  - recalculate-game-stats.ts
  - 모든 게임의 totalReviews, averageRating 재계산
- 사용자 삭제 시 영향받은 게임 자동 통계 업데이트
- 관리자 사용자 삭제 시도 자동 통계 업데이트
- 8개 게임 통계 수정 (삭제된 사용자의 리뷰 반영)

## 기술 스택
- PostgreSQL pg_trgm (trigram 텍스트 검색)
- Prisma (Notification 모델)
- Next.js (Server Components, API Routes)
- Vercel Cron Jobs
- GIN 인덱스

## 개선 효과
- 검색 정확도 대폭 향상 (부분 검색, 오타 허용)
- HOT 게임 실시간 인기도 정확히 반영
- 사용자 간 소셜 기능 추가 (팔로우, 알림)
- 데이터 정합성 자동 유지
- 프로필 개인화 강화

## 참고사항
- pg_trgm 확장 설정: `npm exec tsx scripts/setup-trgm.ts`
- 게임 통계 재계산: `npm exec tsx scripts/recalculate-game-stats.ts`
- 배치 작업: vercel.json에 cron job 설정됨
- 알림 시스템: 실시간 업데이트 없음 (새로고침 필요)
